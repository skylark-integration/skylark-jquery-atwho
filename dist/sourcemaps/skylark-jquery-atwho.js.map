{"version":3,"sources":["skylark-jquery-atwho.js"],"names":["define","$","DEFAULT_CALLBACKS","KEY_CODE","App","ESC","TAB","ENTER","CTRL","A","P","N","LEFT","UP","RIGHT","DOWN","BACKSPACE","SPACE","beforeSave","data","Controller","arrayToDefaultHash","matcher","flag","subtext","should_startWithSpace","acceptSpaceBar","_a","_y","match","regexp","replace","decodeURI","RegExp","exec","filter","query","searchKey","_results","i","item","len","length","String","toLowerCase","indexOf","push","remoteFilter","sorter","items","atwho_order","sort","a","b","tplEval","tpl","map","error1","template","tag","key","pos","highlighter","li","str","$1","$2","$3","beforeInsert","value","$li","e","beforeReposition","offset","afterMatchFailed","at","el","inputor","this","currentFlag","controllers","aliasMaps","$inputor","setupRootElement","listen","prototype","createContainer","doc","ref","$el","remove","body","append","iframe","asRoot","error","window","contentWindow","document","contentDocument","ownerDocument","defaultView","parentWindow","frameElement","fn","atwho","debug","Error","iframeAsRoot","controller","c","current","setContextFor","reg","setting","base","is","EditableController","TextareaController","alias","init","on","_this","view","hide","isComposing","setTimeout","dispatch","onKeyup","onKeydown","expectedQueryCBId","getOpt","lastScrollTop","scrollTop","currentScrollTop","target","shutdown","_","destroy","off","results","lookUp","keyCode","preventDefault","noop","ctrlKey","visible","prev","next","highlighted","choose","slice","app","at1","id","uid","range","model","Model","View","Math","random","toString","substr","Date","getTime","extend","reload","trigger","callDefault","args","funcName","arguments","call","apply","name","eventName","callbacks","default_value","insertContentFor","atwho-at","renderView","text","render","isArray","isPlainObject","wait","type","catchQuery","_delayLookUp","_lookUp","now","remaining","previousCallTime","_stopDelayedCall","delayedCallTimeout","clearTimeout","_generateQueryCBId","_callback","queryCBId","constructor","proxy","child","parent","hasProp","ctor","__super__","hasOwnProperty","superClass","caretPos","content","end","isString","start","val","caret","headPos","endPos","rect","iframeOffset","scaleBottom","left","top","selection","bottom","height","insert","source","startStr","suffix","max","focus","change","Api","_getRange","sel","getSelection","rangeCount","getRangeAt","_setRange","position","node","setEndAfter","setStartAfter","setEndBefore","setStartBefore","collapse","_clearRange","ctrl_a_pressed","removeAllRanges","addRange","_movingEvent","which","_unwrap","unwrap","get","nextSibling","nodeValue","$inserted","$query","_range","index","inserted","lastNode","matched","query_content","collapsed","startContainer","closest","contents","last","test","navigator","userAgent","nodeType","ELEMENT_NODE","startOffset","cloneRange","setStart","cloneContents","TEXT_NODE","previousSibling","addClass","siblings","removeClass","attr","empty","html","surroundContents","setEnd","hasClass","first","getClientRects","scrollLeft","overrides","suffixNode","insertNode","createTextNode","context","storage","saved","fetch","callback","_remoteFilter","save","load","_load","ajax","dataType","done","$elUl","children","timeoutID","bindEvent","header_tpl","charCodeAt","prepend","$menu","lastCoordX","lastCoordY","find","$cur","clientX","clientY","currentTarget","expr","filters","stopShowing","reposition","_window","overflowOffset","width","cur","nextEl","offsetTop","offsetHeight","prevEl","scrollDuration","animate","show","time","isNaN","list","$ul","isSelecting","setIframe","run","method","_args","result","each","$this","Array","displayTpl","insertTpl","headerTpl","functionOverrides","hideWithoutSuffix","startWithSpace","highlightFirst","limit","maxLen","minLen","displayTimeout","delay","spaceSelectsMatch","tabSelectsMatch","editableAtwhoQueryAttrs","suspendOnComposing","lookUpOnClick","main"],"mappings":"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","file":"../skylark-jquery-atwho.js","sourcesContent":["define('skylark-jquery-atwho/atwho',[\n  \"skylark-jquery\"\n],function ($) {\nvar DEFAULT_CALLBACKS, KEY_CODE;\n\nKEY_CODE = {\n  ESC: 27,\n  TAB: 9,\n  ENTER: 13,\n  CTRL: 17,\n  A: 65,\n  P: 80,\n  N: 78,\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n  BACKSPACE: 8,\n  SPACE: 32\n};\n\nDEFAULT_CALLBACKS = {\n  beforeSave: function(data) {\n    return Controller.arrayToDefaultHash(data);\n  },\n  matcher: function(flag, subtext, should_startWithSpace, acceptSpaceBar) {\n    var _a, _y, match, regexp, space;\n    flag = flag.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n    if (should_startWithSpace) {\n      flag = '(?:^|\\\\s)' + flag;\n    }\n    _a = decodeURI(\"%C3%80\");\n    _y = decodeURI(\"%C3%BF\");\n    space = acceptSpaceBar ? \"\\ \" : \"\";\n    regexp = new RegExp(flag + \"([A-Za-z\" + _a + \"-\" + _y + \"0-9_\" + space + \"\\'\\.\\+\\-]*)$|\" + flag + \"([^\\\\x00-\\\\xff]*)$\", 'gi');\n    match = regexp.exec(subtext);\n    if (match) {\n      return match[2] || match[1];\n    } else {\n      return null;\n    }\n  },\n  filter: function(query, data, searchKey) {\n    var _results, i, item, len;\n    _results = [];\n    for (i = 0, len = data.length; i < len; i++) {\n      item = data[i];\n      if (~new String(item[searchKey]).toLowerCase().indexOf(query.toLowerCase())) {\n        _results.push(item);\n      }\n    }\n    return _results;\n  },\n  remoteFilter: null,\n  sorter: function(query, items, searchKey) {\n    var _results, i, item, len;\n    if (!query) {\n      return items;\n    }\n    _results = [];\n    for (i = 0, len = items.length; i < len; i++) {\n      item = items[i];\n      item.atwho_order = new String(item[searchKey]).toLowerCase().indexOf(query.toLowerCase());\n      if (item.atwho_order > -1) {\n        _results.push(item);\n      }\n    }\n    return _results.sort(function(a, b) {\n      return a.atwho_order - b.atwho_order;\n    });\n  },\n  tplEval: function(tpl, map) {\n    var error, error1, template;\n    template = tpl;\n    try {\n      if (typeof tpl !== 'string') {\n        template = tpl(map);\n      }\n      return template.replace(/\\$\\{([^\\}]*)\\}/g, function(tag, key, pos) {\n        return map[key];\n      });\n    } catch (error1) {\n      error = error1;\n      return \"\";\n    }\n  },\n  highlighter: function(li, query) {\n    var regexp;\n    if (!query) {\n      return li;\n    }\n    regexp = new RegExp(\">\\\\s*([^\\<]*?)(\" + query.replace(\"+\", \"\\\\+\") + \")([^\\<]*)\\\\s*<\", 'ig');\n    return li.replace(regexp, function(str, $1, $2, $3) {\n      return '> ' + $1 + '<strong>' + $2 + '</strong>' + $3 + ' <';\n    });\n  },\n  beforeInsert: function(value, $li, e) {\n    return value;\n  },\n  beforeReposition: function(offset) {\n    return offset;\n  },\n  afterMatchFailed: function(at, el) {}\n};\n\nvar App;\n\nApp = (function() {\n  function App(inputor) {\n    this.currentFlag = null;\n    this.controllers = {};\n    this.aliasMaps = {};\n    this.$inputor = $(inputor);\n    this.setupRootElement();\n    this.listen();\n  }\n\n  App.prototype.createContainer = function(doc) {\n    var ref;\n    if ((ref = this.$el) != null) {\n      ref.remove();\n    }\n    return $(doc.body).append(this.$el = $(\"<div class='atwho-container'></div>\"));\n  };\n\n  App.prototype.setupRootElement = function(iframe, asRoot) {\n    var error, error1;\n    if (asRoot == null) {\n      asRoot = false;\n    }\n    if (iframe) {\n      this.window = iframe.contentWindow;\n      this.document = iframe.contentDocument || this.window.document;\n      this.iframe = iframe;\n    } else {\n      this.document = this.$inputor[0].ownerDocument;\n      this.window = this.document.defaultView || this.document.parentWindow;\n      try {\n        this.iframe = this.window.frameElement;\n      } catch (error1) {\n        error = error1;\n        this.iframe = null;\n        if ($.fn.atwho.debug) {\n          throw new Error(\"iframe auto-discovery is failed.\\nPlease use `setIframe` to set the target iframe manually.\\n\" + error);\n        }\n      }\n    }\n    return this.createContainer((this.iframeAsRoot = asRoot) ? this.document : document);\n  };\n\n  App.prototype.controller = function(at) {\n    var c, current, currentFlag, ref;\n    if (this.aliasMaps[at]) {\n      current = this.controllers[this.aliasMaps[at]];\n    } else {\n      ref = this.controllers;\n      for (currentFlag in ref) {\n        c = ref[currentFlag];\n        if (currentFlag === at) {\n          current = c;\n          break;\n        }\n      }\n    }\n    if (current) {\n      return current;\n    } else {\n      return this.controllers[this.currentFlag];\n    }\n  };\n\n  App.prototype.setContextFor = function(at) {\n    this.currentFlag = at;\n    return this;\n  };\n\n  App.prototype.reg = function(flag, setting) {\n    var base, controller;\n    controller = (base = this.controllers)[flag] || (base[flag] = this.$inputor.is('[contentEditable]') ? new EditableController(this, flag) : new TextareaController(this, flag));\n    if (setting.alias) {\n      this.aliasMaps[setting.alias] = flag;\n    }\n    controller.init(setting);\n    return this;\n  };\n\n  App.prototype.listen = function() {\n    return this.$inputor.on('compositionstart', (function(_this) {\n      return function(e) {\n        var ref;\n        if ((ref = _this.controller()) != null) {\n          ref.view.hide();\n        }\n        _this.isComposing = true;\n        return null;\n      };\n    })(this)).on('compositionend', (function(_this) {\n      return function(e) {\n        _this.isComposing = false;\n        setTimeout(function(e) {\n          return _this.dispatch(e);\n        });\n        return null;\n      };\n    })(this)).on('keyup.atwhoInner', (function(_this) {\n      return function(e) {\n        return _this.onKeyup(e);\n      };\n    })(this)).on('keydown.atwhoInner', (function(_this) {\n      return function(e) {\n        return _this.onKeydown(e);\n      };\n    })(this)).on('blur.atwhoInner', (function(_this) {\n      return function(e) {\n        var c;\n        if (c = _this.controller()) {\n          c.expectedQueryCBId = null;\n          return c.view.hide(e, c.getOpt(\"displayTimeout\"));\n        }\n      };\n    })(this)).on('click.atwhoInner', (function(_this) {\n      return function(e) {\n        return _this.dispatch(e);\n      };\n    })(this)).on('scroll.atwhoInner', (function(_this) {\n      return function() {\n        var lastScrollTop;\n        lastScrollTop = _this.$inputor.scrollTop();\n        return function(e) {\n          var currentScrollTop, ref;\n          currentScrollTop = e.target.scrollTop;\n          if (lastScrollTop !== currentScrollTop) {\n            if ((ref = _this.controller()) != null) {\n              ref.view.hide(e);\n            }\n          }\n          lastScrollTop = currentScrollTop;\n          return true;\n        };\n      };\n    })(this)());\n  };\n\n  App.prototype.shutdown = function() {\n    var _, c, ref;\n    ref = this.controllers;\n    for (_ in ref) {\n      c = ref[_];\n      c.destroy();\n      delete this.controllers[_];\n    }\n    this.$inputor.off('.atwhoInner');\n    return this.$el.remove();\n  };\n\n  App.prototype.dispatch = function(e) {\n    var _, c, ref, results;\n    ref = this.controllers;\n    results = [];\n    for (_ in ref) {\n      c = ref[_];\n      results.push(c.lookUp(e));\n    }\n    return results;\n  };\n\n  App.prototype.onKeyup = function(e) {\n    var ref;\n    switch (e.keyCode) {\n      case KEY_CODE.ESC:\n        e.preventDefault();\n        if ((ref = this.controller()) != null) {\n          ref.view.hide();\n        }\n        break;\n      case KEY_CODE.DOWN:\n      case KEY_CODE.UP:\n      case KEY_CODE.CTRL:\n      case KEY_CODE.ENTER:\n        $.noop();\n        break;\n      case KEY_CODE.P:\n      case KEY_CODE.N:\n        if (!e.ctrlKey) {\n          this.dispatch(e);\n        }\n        break;\n      default:\n        this.dispatch(e);\n    }\n  };\n\n  App.prototype.onKeydown = function(e) {\n    var ref, view;\n    view = (ref = this.controller()) != null ? ref.view : void 0;\n    if (!(view && view.visible())) {\n      return;\n    }\n    switch (e.keyCode) {\n      case KEY_CODE.ESC:\n        e.preventDefault();\n        view.hide(e);\n        break;\n      case KEY_CODE.UP:\n        e.preventDefault();\n        view.prev();\n        break;\n      case KEY_CODE.DOWN:\n        e.preventDefault();\n        view.next();\n        break;\n      case KEY_CODE.P:\n        if (!e.ctrlKey) {\n          return;\n        }\n        e.preventDefault();\n        view.prev();\n        break;\n      case KEY_CODE.N:\n        if (!e.ctrlKey) {\n          return;\n        }\n        e.preventDefault();\n        view.next();\n        break;\n      case KEY_CODE.TAB:\n      case KEY_CODE.ENTER:\n      case KEY_CODE.SPACE:\n        if (!view.visible()) {\n          return;\n        }\n        if (!this.controller().getOpt('spaceSelectsMatch') && e.keyCode === KEY_CODE.SPACE) {\n          return;\n        }\n        if (!this.controller().getOpt('tabSelectsMatch') && e.keyCode === KEY_CODE.TAB) {\n          return;\n        }\n        if (view.highlighted()) {\n          e.preventDefault();\n          view.choose(e);\n        } else {\n          view.hide(e);\n        }\n        break;\n      default:\n        $.noop();\n    }\n  };\n\n  return App;\n\n})();\n\nvar Controller,\n  slice = [].slice;\n\nController = (function() {\n  Controller.prototype.uid = function() {\n    return (Math.random().toString(16) + \"000000000\").substr(2, 8) + (new Date().getTime());\n  };\n\n  function Controller(app, at1) {\n    this.app = app;\n    this.at = at1;\n    this.$inputor = this.app.$inputor;\n    this.id = this.$inputor[0].id || this.uid();\n    this.expectedQueryCBId = null;\n    this.setting = null;\n    this.query = null;\n    this.pos = 0;\n    this.range = null;\n    if ((this.$el = $(\"#atwho-ground-\" + this.id, this.app.$el)).length === 0) {\n      this.app.$el.append(this.$el = $(\"<div id='atwho-ground-\" + this.id + \"'></div>\"));\n    }\n    this.model = new Model(this);\n    this.view = new View(this);\n  }\n\n  Controller.prototype.init = function(setting) {\n    this.setting = $.extend({}, this.setting || $.fn.atwho[\"default\"], setting);\n    this.view.init();\n    return this.model.reload(this.setting.data);\n  };\n\n  Controller.prototype.destroy = function() {\n    this.trigger('beforeDestroy');\n    this.model.destroy();\n    this.view.destroy();\n    return this.$el.remove();\n  };\n\n  Controller.prototype.callDefault = function() {\n    var args, error, error1, funcName;\n    funcName = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    try {\n      return DEFAULT_CALLBACKS[funcName].apply(this, args);\n    } catch (error1) {\n      error = error1;\n      return $.error(error + \" Or maybe At.js doesn't have function \" + funcName);\n    }\n  };\n\n  Controller.prototype.trigger = function(name, data) {\n    var alias, eventName;\n    if (data == null) {\n      data = [];\n    }\n    data.push(this);\n    alias = this.getOpt('alias');\n    eventName = alias ? name + \"-\" + alias + \".atwho\" : name + \".atwho\";\n    return this.$inputor.trigger(eventName, data);\n  };\n\n  Controller.prototype.callbacks = function(funcName) {\n    return this.getOpt(\"callbacks\")[funcName] || DEFAULT_CALLBACKS[funcName];\n  };\n\n  Controller.prototype.getOpt = function(at, default_value) {\n    var e, error1;\n    try {\n      return this.setting[at];\n    } catch (error1) {\n      e = error1;\n      return null;\n    }\n  };\n\n  Controller.prototype.insertContentFor = function($li) {\n    var data, tpl;\n    tpl = this.getOpt('insertTpl');\n    data = $.extend({}, $li.data('item-data'), {\n      'atwho-at': this.at\n    });\n    return this.callbacks(\"tplEval\").call(this, tpl, data, \"onInsert\");\n  };\n\n  Controller.prototype.renderView = function(data) {\n    var searchKey;\n    searchKey = this.getOpt(\"searchKey\");\n    data = this.callbacks(\"sorter\").call(this, this.query.text, data.slice(0, 1001), searchKey);\n    return this.view.render(data.slice(0, this.getOpt('limit')));\n  };\n\n  Controller.arrayToDefaultHash = function(data) {\n    var i, item, len, results;\n    if (!$.isArray(data)) {\n      return data;\n    }\n    results = [];\n    for (i = 0, len = data.length; i < len; i++) {\n      item = data[i];\n      if ($.isPlainObject(item)) {\n        results.push(item);\n      } else {\n        results.push({\n          name: item\n        });\n      }\n    }\n    return results;\n  };\n\n  Controller.prototype.lookUp = function(e) {\n    var query, wait;\n    if (e && e.type === 'click' && !this.getOpt('lookUpOnClick')) {\n      return;\n    }\n    if (this.getOpt('suspendOnComposing') && this.app.isComposing) {\n      return;\n    }\n    query = this.catchQuery(e);\n    if (!query) {\n      this.expectedQueryCBId = null;\n      return query;\n    }\n    this.app.setContextFor(this.at);\n    if (wait = this.getOpt('delay')) {\n      this._delayLookUp(query, wait);\n    } else {\n      this._lookUp(query);\n    }\n    return query;\n  };\n\n  Controller.prototype._delayLookUp = function(query, wait) {\n    var now, remaining;\n    now = Date.now ? Date.now() : new Date().getTime();\n    this.previousCallTime || (this.previousCallTime = now);\n    remaining = wait - (now - this.previousCallTime);\n    if ((0 < remaining && remaining < wait)) {\n      this.previousCallTime = now;\n      this._stopDelayedCall();\n      return this.delayedCallTimeout = setTimeout((function(_this) {\n        return function() {\n          _this.previousCallTime = 0;\n          _this.delayedCallTimeout = null;\n          return _this._lookUp(query);\n        };\n      })(this), wait);\n    } else {\n      this._stopDelayedCall();\n      if (this.previousCallTime !== now) {\n        this.previousCallTime = 0;\n      }\n      return this._lookUp(query);\n    }\n  };\n\n  Controller.prototype._stopDelayedCall = function() {\n    if (this.delayedCallTimeout) {\n      clearTimeout(this.delayedCallTimeout);\n      return this.delayedCallTimeout = null;\n    }\n  };\n\n  Controller.prototype._generateQueryCBId = function() {\n    return {};\n  };\n\n  Controller.prototype._lookUp = function(query) {\n    var _callback;\n    _callback = function(queryCBId, data) {\n      if (queryCBId !== this.expectedQueryCBId) {\n        return;\n      }\n      if (data && data.length > 0) {\n        return this.renderView(this.constructor.arrayToDefaultHash(data));\n      } else {\n        return this.view.hide();\n      }\n    };\n    this.expectedQueryCBId = this._generateQueryCBId();\n    return this.model.query(query.text, $.proxy(_callback, this, this.expectedQueryCBId));\n  };\n\n  return Controller;\n\n})();\n\nvar TextareaController,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nTextareaController = (function(superClass) {\n  extend(TextareaController, superClass);\n\n  function TextareaController() {\n    return TextareaController.__super__.constructor.apply(this, arguments);\n  }\n\n  TextareaController.prototype.catchQuery = function() {\n    var caretPos, content, end, isString, query, start, subtext;\n    content = this.$inputor.val();\n    caretPos = this.$inputor.caret('pos', {\n      iframe: this.app.iframe\n    });\n    subtext = content.slice(0, caretPos);\n    query = this.callbacks(\"matcher\").call(this, this.at, subtext, this.getOpt('startWithSpace'), this.getOpt(\"acceptSpaceBar\"));\n    isString = typeof query === 'string';\n    if (isString && query.length < this.getOpt('minLen', 0)) {\n      return;\n    }\n    if (isString && query.length <= this.getOpt('maxLen', 20)) {\n      start = caretPos - query.length;\n      end = start + query.length;\n      this.pos = start;\n      query = {\n        'text': query,\n        'headPos': start,\n        'endPos': end\n      };\n      this.trigger(\"matched\", [this.at, query.text]);\n    } else {\n      query = null;\n      this.view.hide();\n    }\n    return this.query = query;\n  };\n\n  TextareaController.prototype.rect = function() {\n    var c, iframeOffset, scaleBottom;\n    if (!(c = this.$inputor.caret('offset', this.pos - 1, {\n      iframe: this.app.iframe\n    }))) {\n      return;\n    }\n    if (this.app.iframe && !this.app.iframeAsRoot) {\n      iframeOffset = $(this.app.iframe).offset();\n      c.left += iframeOffset.left;\n      c.top += iframeOffset.top;\n    }\n    scaleBottom = this.app.document.selection ? 0 : 2;\n    return {\n      left: c.left,\n      top: c.top,\n      bottom: c.top + c.height + scaleBottom\n    };\n  };\n\n  TextareaController.prototype.insert = function(content, $li) {\n    var $inputor, source, startStr, suffix, text;\n    $inputor = this.$inputor;\n    source = $inputor.val();\n    startStr = source.slice(0, Math.max(this.query.headPos - this.at.length, 0));\n    suffix = (suffix = this.getOpt('suffix')) === \"\" ? suffix : suffix || \" \";\n    content += suffix;\n    text = \"\" + startStr + content + (source.slice(this.query['endPos'] || 0));\n    $inputor.val(text);\n    $inputor.caret('pos', startStr.length + content.length, {\n      iframe: this.app.iframe\n    });\n    if (!$inputor.is(':focus')) {\n      $inputor.focus();\n    }\n    return $inputor.change();\n  };\n\n  return TextareaController;\n\n})(Controller);\n\nvar EditableController,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nEditableController = (function(superClass) {\n  extend(EditableController, superClass);\n\n  function EditableController() {\n    return EditableController.__super__.constructor.apply(this, arguments);\n  }\n\n  EditableController.prototype._getRange = function() {\n    var sel;\n    sel = this.app.window.getSelection();\n    if (sel.rangeCount > 0) {\n      return sel.getRangeAt(0);\n    }\n  };\n\n  EditableController.prototype._setRange = function(position, node, range) {\n    if (range == null) {\n      range = this._getRange();\n    }\n    if (!(range && node)) {\n      return;\n    }\n    node = $(node)[0];\n    if (position === 'after') {\n      range.setEndAfter(node);\n      range.setStartAfter(node);\n    } else {\n      range.setEndBefore(node);\n      range.setStartBefore(node);\n    }\n    range.collapse(false);\n    return this._clearRange(range);\n  };\n\n  EditableController.prototype._clearRange = function(range) {\n    var sel;\n    if (range == null) {\n      range = this._getRange();\n    }\n    sel = this.app.window.getSelection();\n    if (this.ctrl_a_pressed == null) {\n      sel.removeAllRanges();\n      return sel.addRange(range);\n    }\n  };\n\n  EditableController.prototype._movingEvent = function(e) {\n    var ref;\n    return e.type === 'click' || ((ref = e.which) === KEY_CODE.RIGHT || ref === KEY_CODE.LEFT || ref === KEY_CODE.UP || ref === KEY_CODE.DOWN);\n  };\n\n  EditableController.prototype._unwrap = function(node) {\n    var next;\n    node = $(node).unwrap().get(0);\n    if ((next = node.nextSibling) && next.nodeValue) {\n      node.nodeValue += next.nodeValue;\n      $(next).remove();\n    }\n    return node;\n  };\n\n  EditableController.prototype.catchQuery = function(e) {\n    var $inserted, $query, _range, index, inserted, isString, lastNode, matched, offset, query, query_content, range;\n    if (!(range = this._getRange())) {\n      return;\n    }\n    if (!range.collapsed) {\n      return;\n    }\n    if (e.which === KEY_CODE.ENTER) {\n      ($query = $(range.startContainer).closest('.atwho-query')).contents().unwrap();\n      if ($query.is(':empty')) {\n        $query.remove();\n      }\n      ($query = $(\".atwho-query\", this.app.document)).text($query.text()).contents().last().unwrap();\n      this._clearRange();\n      return;\n    }\n    if (/firefox/i.test(navigator.userAgent)) {\n      if ($(range.startContainer).is(this.$inputor)) {\n        this._clearRange();\n        return;\n      }\n      if (e.which === KEY_CODE.BACKSPACE && range.startContainer.nodeType === document.ELEMENT_NODE && (offset = range.startOffset - 1) >= 0) {\n        _range = range.cloneRange();\n        _range.setStart(range.startContainer, offset);\n        if ($(_range.cloneContents()).contents().last().is('.atwho-inserted')) {\n          inserted = $(range.startContainer).contents().get(offset);\n          this._setRange('after', $(inserted).contents().last());\n        }\n      } else if (e.which === KEY_CODE.LEFT && range.startContainer.nodeType === document.TEXT_NODE) {\n        $inserted = $(range.startContainer.previousSibling);\n        if ($inserted.is('.atwho-inserted') && range.startOffset === 0) {\n          this._setRange('after', $inserted.contents().last());\n        }\n      }\n    }\n    $(range.startContainer).closest('.atwho-inserted').addClass('atwho-query').siblings().removeClass('atwho-query');\n    if (($query = $(\".atwho-query\", this.app.document)).length > 0 && $query.is(':empty') && $query.text().length === 0) {\n      $query.remove();\n    }\n    if (!this._movingEvent(e)) {\n      $query.removeClass('atwho-inserted');\n    }\n    if ($query.length > 0) {\n      switch (e.which) {\n        case KEY_CODE.LEFT:\n          this._setRange('before', $query.get(0), range);\n          $query.removeClass('atwho-query');\n          return;\n        case KEY_CODE.RIGHT:\n          this._setRange('after', $query.get(0).nextSibling, range);\n          $query.removeClass('atwho-query');\n          return;\n      }\n    }\n    if ($query.length > 0 && (query_content = $query.attr('data-atwho-at-query'))) {\n      $query.empty().html(query_content).attr('data-atwho-at-query', null);\n      this._setRange('after', $query.get(0), range);\n    }\n    _range = range.cloneRange();\n    _range.setStart(range.startContainer, 0);\n    matched = this.callbacks(\"matcher\").call(this, this.at, _range.toString(), this.getOpt('startWithSpace'), this.getOpt(\"acceptSpaceBar\"));\n    isString = typeof matched === 'string';\n    if ($query.length === 0 && isString && (index = range.startOffset - this.at.length - matched.length) >= 0) {\n      range.setStart(range.startContainer, index);\n      $query = $('<span/>', this.app.document).attr(this.getOpt(\"editableAtwhoQueryAttrs\")).addClass('atwho-query');\n      range.surroundContents($query.get(0));\n      lastNode = $query.contents().last().get(0);\n      if (lastNode) {\n        if (/firefox/i.test(navigator.userAgent)) {\n          range.setStart(lastNode, lastNode.length);\n          range.setEnd(lastNode, lastNode.length);\n          this._clearRange(range);\n        } else {\n          this._setRange('after', lastNode, range);\n        }\n      }\n    }\n    if (isString && matched.length < this.getOpt('minLen', 0)) {\n      return;\n    }\n    if (isString && matched.length <= this.getOpt('maxLen', 20)) {\n      query = {\n        text: matched,\n        el: $query\n      };\n      this.trigger(\"matched\", [this.at, query.text]);\n      return this.query = query;\n    } else {\n      this.view.hide();\n      this.query = {\n        el: $query\n      };\n      if ($query.text().indexOf(this.at) >= 0) {\n        if (this._movingEvent(e) && $query.hasClass('atwho-inserted')) {\n          $query.removeClass('atwho-query');\n        } else if (false !== this.callbacks('afterMatchFailed').call(this, this.at, $query)) {\n          this._setRange(\"after\", this._unwrap($query.text($query.text()).contents().first()));\n        }\n      }\n      return null;\n    }\n  };\n\n  EditableController.prototype.rect = function() {\n    var $iframe, iframeOffset, rect;\n    rect = this.query.el.offset();\n    if (!(rect && this.query.el[0].getClientRects().length)) {\n      return;\n    }\n    if (this.app.iframe && !this.app.iframeAsRoot) {\n      iframeOffset = ($iframe = $(this.app.iframe)).offset();\n      rect.left += iframeOffset.left - this.$inputor.scrollLeft();\n      rect.top += iframeOffset.top - this.$inputor.scrollTop();\n    }\n    rect.bottom = rect.top + this.query.el.height();\n    return rect;\n  };\n\n  EditableController.prototype.insert = function(content, $li) {\n    var data, overrides, range, suffix, suffixNode;\n    if (!this.$inputor.is(':focus')) {\n      this.$inputor.focus();\n    }\n    overrides = this.getOpt('functionOverrides');\n    if (overrides.insert) {\n      return overrides.insert.call(this, content, $li);\n    }\n    suffix = (suffix = this.getOpt('suffix')) === \"\" ? suffix : suffix || \"\\u00A0\";\n    data = $li.data('item-data');\n    this.query.el.removeClass('atwho-query').addClass('atwho-inserted').html(content).attr('data-atwho-at-query', \"\" + data['atwho-at'] + this.query.text).attr('contenteditable', \"false\");\n    if (range = this._getRange()) {\n      if (this.query.el.length) {\n        range.setEndAfter(this.query.el[0]);\n      }\n      range.collapse(false);\n      range.insertNode(suffixNode = this.app.document.createTextNode(\"\" + suffix));\n      this._setRange('after', suffixNode, range);\n    }\n    if (!this.$inputor.is(':focus')) {\n      this.$inputor.focus();\n    }\n    return this.$inputor.change();\n  };\n\n  return EditableController;\n\n})(Controller);\n\nvar Model;\n\nModel = (function() {\n  function Model(context) {\n    this.context = context;\n    this.at = this.context.at;\n    this.storage = this.context.$inputor;\n  }\n\n  Model.prototype.destroy = function() {\n    return this.storage.data(this.at, null);\n  };\n\n  Model.prototype.saved = function() {\n    return this.fetch() > 0;\n  };\n\n  Model.prototype.query = function(query, callback) {\n    var _remoteFilter, data, searchKey;\n    data = this.fetch();\n    searchKey = this.context.getOpt(\"searchKey\");\n    data = this.context.callbacks('filter').call(this.context, query, data, searchKey) || [];\n    _remoteFilter = this.context.callbacks('remoteFilter');\n    if (data.length > 0 || (!_remoteFilter && data.length === 0)) {\n      return callback(data);\n    } else {\n      return _remoteFilter.call(this.context, query, callback);\n    }\n  };\n\n  Model.prototype.fetch = function() {\n    return this.storage.data(this.at) || [];\n  };\n\n  Model.prototype.save = function(data) {\n    return this.storage.data(this.at, this.context.callbacks(\"beforeSave\").call(this.context, data || []));\n  };\n\n  Model.prototype.load = function(data) {\n    if (!(this.saved() || !data)) {\n      return this._load(data);\n    }\n  };\n\n  Model.prototype.reload = function(data) {\n    return this._load(data);\n  };\n\n  Model.prototype._load = function(data) {\n    if (typeof data === \"string\") {\n      return $.ajax(data, {\n        dataType: \"json\"\n      }).done((function(_this) {\n        return function(data) {\n          return _this.save(data);\n        };\n      })(this));\n    } else {\n      return this.save(data);\n    }\n  };\n\n  return Model;\n\n})();\n\nvar View;\n\nView = (function() {\n  function View(context) {\n    this.context = context;\n    this.$el = $(\"<div class='atwho-view'><ul class='atwho-view-ul'></ul></div>\");\n    this.$elUl = this.$el.children();\n    this.timeoutID = null;\n    this.context.$el.append(this.$el);\n    this.bindEvent();\n  }\n\n  View.prototype.init = function() {\n    var header_tpl, id;\n    id = this.context.getOpt(\"alias\") || this.context.at.charCodeAt(0);\n    header_tpl = this.context.getOpt(\"headerTpl\");\n    if (header_tpl && this.$el.children().length === 1) {\n      this.$el.prepend(header_tpl);\n    }\n    return this.$el.attr({\n      'id': \"at-view-\" + id\n    });\n  };\n\n  View.prototype.destroy = function() {\n    return this.$el.remove();\n  };\n\n  View.prototype.bindEvent = function() {\n    var $menu, lastCoordX, lastCoordY;\n    $menu = this.$el.find('ul');\n    lastCoordX = 0;\n    lastCoordY = 0;\n    return $menu.on('mousemove.atwho-view', 'li', (function(_this) {\n      return function(e) {\n        var $cur;\n        if (lastCoordX === e.clientX && lastCoordY === e.clientY) {\n          return;\n        }\n        lastCoordX = e.clientX;\n        lastCoordY = e.clientY;\n        $cur = $(e.currentTarget);\n        if ($cur.hasClass('cur')) {\n          return;\n        }\n        $menu.find('.cur').removeClass('cur');\n        return $cur.addClass('cur');\n      };\n    })(this)).on('click.atwho-view', 'li', (function(_this) {\n      return function(e) {\n        $menu.find('.cur').removeClass('cur');\n        $(e.currentTarget).addClass('cur');\n        _this.choose(e);\n        return e.preventDefault();\n      };\n    })(this));\n  };\n\n  View.prototype.visible = function() {\n    return $.expr.filters.visible(this.$el[0]);\n  };\n\n  View.prototype.highlighted = function() {\n    return this.$el.find(\".cur\").length > 0;\n  };\n\n  View.prototype.choose = function(e) {\n    var $li, content;\n    if (($li = this.$el.find(\".cur\")).length) {\n      content = this.context.insertContentFor($li);\n      this.context._stopDelayedCall();\n      this.context.insert(this.context.callbacks(\"beforeInsert\").call(this.context, content, $li, e), $li);\n      this.context.trigger(\"inserted\", [$li, e]);\n      this.hide(e);\n    }\n    if (this.context.getOpt(\"hideWithoutSuffix\")) {\n      return this.stopShowing = true;\n    }\n  };\n\n  View.prototype.reposition = function(rect) {\n    var _window, offset, overflowOffset, ref;\n    _window = this.context.app.iframeAsRoot ? this.context.app.window : window;\n    if (rect.bottom + this.$el.height() - $(_window).scrollTop() > $(_window).height()) {\n      rect.bottom = rect.top - this.$el.height();\n    }\n    if (rect.left > (overflowOffset = $(_window).width() - this.$el.width() - 5)) {\n      rect.left = overflowOffset;\n    }\n    offset = {\n      left: rect.left,\n      top: rect.bottom\n    };\n    if ((ref = this.context.callbacks(\"beforeReposition\")) != null) {\n      ref.call(this.context, offset);\n    }\n    this.$el.offset(offset);\n    return this.context.trigger(\"reposition\", [offset]);\n  };\n\n  View.prototype.next = function() {\n    var cur, next, nextEl, offset;\n    cur = this.$el.find('.cur').removeClass('cur');\n    next = cur.next();\n    if (!next.length) {\n      next = this.$el.find('li:first');\n    }\n    next.addClass('cur');\n    nextEl = next[0];\n    offset = nextEl.offsetTop + nextEl.offsetHeight + (nextEl.nextSibling ? nextEl.nextSibling.offsetHeight : 0);\n    return this.scrollTop(Math.max(0, offset - this.$el.height()));\n  };\n\n  View.prototype.prev = function() {\n    var cur, offset, prev, prevEl;\n    cur = this.$el.find('.cur').removeClass('cur');\n    prev = cur.prev();\n    if (!prev.length) {\n      prev = this.$el.find('li:last');\n    }\n    prev.addClass('cur');\n    prevEl = prev[0];\n    offset = prevEl.offsetTop + prevEl.offsetHeight + (prevEl.nextSibling ? prevEl.nextSibling.offsetHeight : 0);\n    return this.scrollTop(Math.max(0, offset - this.$el.height()));\n  };\n\n  View.prototype.scrollTop = function(scrollTop) {\n    var scrollDuration;\n    scrollDuration = this.context.getOpt('scrollDuration');\n    if (scrollDuration) {\n      return this.$elUl.animate({\n        scrollTop: scrollTop\n      }, scrollDuration);\n    } else {\n      return this.$elUl.scrollTop(scrollTop);\n    }\n  };\n\n  View.prototype.show = function() {\n    var rect;\n    if (this.stopShowing) {\n      this.stopShowing = false;\n      return;\n    }\n    if (!this.visible()) {\n      this.$el.show();\n      this.$el.scrollTop(0);\n      this.context.trigger('shown');\n    }\n    if (rect = this.context.rect()) {\n      return this.reposition(rect);\n    }\n  };\n\n  View.prototype.hide = function(e, time) {\n    var callback;\n    if (!this.visible()) {\n      return;\n    }\n    if (isNaN(time)) {\n      this.$el.hide();\n      return this.context.trigger('hidden', [e]);\n    } else {\n      callback = (function(_this) {\n        return function() {\n          return _this.hide();\n        };\n      })(this);\n      clearTimeout(this.timeoutID);\n      return this.timeoutID = setTimeout(callback, time);\n    }\n  };\n\n  View.prototype.render = function(list) {\n    var $li, $ul, i, item, len, li, tpl;\n    if (!($.isArray(list) && list.length > 0)) {\n      this.hide();\n      return;\n    }\n    this.$el.find('ul').empty();\n    $ul = this.$el.find('ul');\n    tpl = this.context.getOpt('displayTpl');\n    for (i = 0, len = list.length; i < len; i++) {\n      item = list[i];\n      item = $.extend({}, item, {\n        'atwho-at': this.context.at\n      });\n      li = this.context.callbacks(\"tplEval\").call(this.context, tpl, item, \"onDisplay\");\n      $li = $(this.context.callbacks(\"highlighter\").call(this.context, li, this.context.query.text));\n      $li.data(\"item-data\", item);\n      $ul.append($li);\n    }\n    this.show();\n    if (this.context.getOpt('highlightFirst')) {\n      return $ul.find(\"li:first\").addClass(\"cur\");\n    }\n  };\n\n  return View;\n\n})();\n\nvar Api;\n\nApi = {\n  load: function(at, data) {\n    var c;\n    if (c = this.controller(at)) {\n      return c.model.load(data);\n    }\n  },\n  isSelecting: function() {\n    var ref;\n    return !!((ref = this.controller()) != null ? ref.view.visible() : void 0);\n  },\n  hide: function() {\n    var ref;\n    return (ref = this.controller()) != null ? ref.view.hide() : void 0;\n  },\n  reposition: function() {\n    var c;\n    if (c = this.controller()) {\n      return c.view.reposition(c.rect());\n    }\n  },\n  setIframe: function(iframe, asRoot) {\n    this.setupRootElement(iframe, asRoot);\n    return null;\n  },\n  run: function() {\n    return this.dispatch();\n  },\n  destroy: function() {\n    this.shutdown();\n    return this.$inputor.data('atwho', null);\n  }\n};\n\n$.fn.atwho = function(method) {\n  var _args, result;\n  _args = arguments;\n  result = null;\n  this.filter('textarea, input, [contenteditable=\"\"], [contenteditable=true]').each(function() {\n    var $this, app;\n    if (!(app = ($this = $(this)).data(\"atwho\"))) {\n      $this.data('atwho', (app = new App(this)));\n    }\n    if (typeof method === 'object' || !method) {\n      return app.reg(method.at, method);\n    } else if (Api[method] && app) {\n      return result = Api[method].apply(app, Array.prototype.slice.call(_args, 1));\n    } else {\n      return $.error(\"Method \" + method + \" does not exist on jQuery.atwho\");\n    }\n  });\n  if (result != null) {\n    return result;\n  } else {\n    return this;\n  }\n};\n\n$.fn.atwho[\"default\"] = {\n  at: void 0,\n  alias: void 0,\n  data: null,\n  displayTpl: \"<li>${name}</li>\",\n  insertTpl: \"${atwho-at}${name}\",\n  headerTpl: null,\n  callbacks: DEFAULT_CALLBACKS,\n  functionOverrides: {},\n  searchKey: \"name\",\n  suffix: void 0,\n  hideWithoutSuffix: false,\n  startWithSpace: true,\n  acceptSpaceBar: false,\n  highlightFirst: true,\n  limit: 5,\n  maxLen: 20,\n  minLen: 0,\n  displayTimeout: 300,\n  delay: null,\n  spaceSelectsMatch: false,\n  tabSelectsMatch: true,\n  editableAtwhoQueryAttrs: {},\n  scrollDuration: 150,\n  suspendOnComposing: true,\n  lookUpOnClick: true\n};\n\n$.fn.atwho.debug = false;\n\n});\n\ndefine('skylark-jquery-atwho/main',[\"./atwho\"],function($){\r\n\treturn $;\r\n});\ndefine('skylark-jquery-atwho', ['skylark-jquery-atwho/main'], function (main) { return main; });\n\n"]}